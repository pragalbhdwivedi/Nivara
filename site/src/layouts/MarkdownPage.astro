---
import BaseLayout from "./BaseLayout.astro";
import CanonMarkdown from "../components/CanonMarkdown.astro";

const { title, heading, sections = [], toc = [] } = Astro.props;
---

<BaseLayout title={title}>
  <section>
    <h1>{heading}</h1>
  </section>

  <slot name="lead" />

  <div class="canon-shell">
    <div class="canon-body">
      {sections.map((section) => (
        <CanonMarkdown>
          <div set:html={section.html} />
        </CanonMarkdown>
      ))}
    </div>
    {toc.length > 0 && (
      <aside class="canon-toc">
        <h2>On this page</h2>
        <ul>
          {toc.map((item) => (
            <li class={`level-${item.level}`}>
              <a href={`#${item.slug}`}>{item.text}</a>
            </li>
          ))}
        </ul>
      </aside>
    )}
  </div>
</BaseLayout>

<style>
  .canon-shell {
    display: grid;
    grid-template-columns: minmax(0, 1fr) 240px;
    gap: 2rem;
  }

  .canon-body {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  .canon-toc {
    position: sticky;
    top: 6rem;
    align-self: start;
    padding: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    background: rgba(12, 14, 24, 0.6);
    font-size: 0.9rem;
  }

  .canon-toc h2 {
    margin: 0 0 0.75rem;
    font-size: 1rem;
  }

  .canon-toc ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
  }

  .canon-toc li.level-3 {
    padding-left: 0.75rem;
  }

  .canon-toc li.level-4 {
    padding-left: 1.2rem;
  }

  .canon-toc a {
    color: #a9baff;
  }

  @media (max-width: 960px) {
    .canon-shell {
      grid-template-columns: 1fr;
    }

    .canon-toc {
      position: static;
    }
  }
</style>
